import { useState } from "react"
import { Plus } from "lucide-react"

const ACCENT = "#0D00FF"
const TEXT_WHITE = "#F2F2F2"
const TEXT_BLACK = "#262626"

const TITLE_STYLE = {
    fontFamily: "Inter",
    fontWeight: "900",
    fontSize: 40,
    color: ACCENT,
}
const SUBTITLE_STYLE = { fontFamily: "Inter", fontSize: 20, color: ACCENT }
const PARAGRAPH_STYLE = {
    fontFamily: "Inter",
    fontSize: 14,
    color: TEXT_BLACK,
    marginTop: 10,
    maxWidth: 500,
}
const USD_STYLE = { fontSize: 30, verticalAlign: "top", marginLeft: 5 }

export default function ProjectCalculator() {
    const [m2, setM2] = useState(100)
    const [rooms, setRooms] = useState(1)
    const [bathrooms, setBathrooms] = useState(1.5)
    const [floors, setFloors] = useState(1)
    const [cars, setCars] = useState(1)
    const [extras, setExtras] = useState<string[]>([])
    const [interiorDesign, setInteriorDesign] = useState("no")
    const [showInfo, setShowInfo] = useState(false)

    const toggleExtra = (op: string) => {
        setExtras((prev) =>
            prev.includes(op) ? prev.filter((x) => x !== op) : [...prev, op]
        )
    }

    const calculateCost = () => {
        let total = m2 * 4
        total += (rooms - 1) * 100
        total += (floors - 1) * 500
        total += (cars - 1) * 50

        if (bathrooms > 1.5) {
            total += (bathrooms - 1.5) * 80
        }

        if (extras.includes("Outdoor Kitchen")) total += 100
        if (extras.includes("Outdoor Fireplace")) total += 90
        if (extras.includes("Patio")) total += 50
        if (extras.includes("Laundry")) total += 60
        if (extras.includes("Pool")) total += 400

        if (interiorDesign === "yes") total += 400

        return Math.round(total)
    }

    const sendWhatsapp = () => {
        const details = `
👋 Hi! I just calculated my project using your tool and I'm interested in moving forward. 🚀

📐 Built area: ${m2} m²
🛏️ Rooms: ${rooms}
🏢 Floors: ${floors}
🚗 Parking spots: ${cars}
🚿 Bathrooms: ${bathrooms}
✨ Additional options: ${extras.join(", ") || "None"}
🎨 Includes interior design?: ${interiorDesign === "yes" ? "Yes" : "No"}

💰 Estimated cost: $${calculateCost()} USD

🧱 I'd love to know the next step to continue the quotation and bring this project to life. 🙌
Thank you! 😊`.trim()

        const url = `https://wa.me/573043618282?text=${encodeURIComponent(details)}`
        window.open(url, "_blank")
    }

    const buildSelector = (
        label: string,
        values: (string | number)[],
        value: any,
        setValue: any
    ) => (
        <div style={{ marginTop: 20 }}>
            <div style={SUBTITLE_STYLE}>{label}</div>
            <div
                style={{
                    display: "flex",
                    flexWrap: "wrap",
                    gap: 10,
                    marginTop: 10,
                }}
            >
                {values.map((val, idx) => (
                    <div
                        key={idx}
                        onClick={() => {
                            if (val === "text") {
                                const input = prompt("Enter the number")
                                const parsed = parseFloat(input || "")
                                if (!isNaN(parsed)) setValue(parsed)
                            } else {
                                setValue(val)
                            }
                        }}
                        style={{
                            width: "40px",
                            height: "40px",
                            minWidth: "36px",
                            minHeight: "36px",
                            maxWidth: "40px",
                            maxHeight: "40px",
                            borderRadius: 5,
                            backgroundColor:
                                value === val ? ACCENT : "transparent",
                            border: `2px solid ${ACCENT}`,
                            color: value === val ? TEXT_WHITE : TEXT_BLACK,
                            display: "flex",
                            justifyContent: "center",
                            alignItems: "center",
                            cursor: "pointer",
                            fontSize: "clamp(16px, 2vw, 20px)",
                            fontFamily: "Inter",
                        }}
                    >
                        {val}
                    </div>
                ))}
            </div>
        </div>
    )

    return (
        <div
            style={{
                padding: 30,
                fontFamily: "Inter",
                background: "transparent",
                color: TEXT_BLACK,
            }}
        >
            <div style={{ ...TITLE_STYLE }}>Project Calculator</div>
            <hr style={{ borderColor: ACCENT, marginTop: 10 }} />

            <div style={{ marginTop: 20, fontSize: 20, color: ACCENT }}>
                m²:{" "}
                <span
                    style={{
                        backgroundColor: ACCENT,
                        color: TEXT_WHITE,
                        borderRadius: 20,
                        padding: "5px 15px",
                    }}
                >
                    {m2}
                </span>
            </div>
            <input
                type="range"
                min={0}
                max={500}
                value={m2}
                onChange={(e) => setM2(parseInt(e.target.value))}
                style={{ width: "100%", marginTop: 10, accentColor: ACCENT }}
            />

            {buildSelector("Rooms", [1, 2, 3, 4, 5, "text"], rooms, setRooms)}
            {buildSelector("Floors", [1, 2, 3, "text"], floors, setFloors)}
            {buildSelector(
                "Parking spots",
                [1, 2, 3, 4, 5, "text"],
                cars,
                setCars
            )}
            {buildSelector(
                "Bathrooms",
                [1, 1.5, 2, 2.5, 3, 3.5, 4, 4.5, 5, "text"],
                bathrooms,
                setBathrooms
            )}

            <hr style={{ borderColor: ACCENT, marginTop: 30 }} />
            <div style={{ ...TITLE_STYLE, marginTop: 10 }}>
                Additional Options
            </div>

            <div
                style={{
                    display: "flex",
                    gap: 20,
                    marginTop: 10,
                    flexWrap: "wrap",
                }}
            >
                {[
                    "Pool",
                    "Laundry",
                    "Outdoor Kitchen",
                    "Patio",
                    "Outdoor Fireplace",
                ].map((op, idx) => (
                    <div
                        key={idx}
                        onClick={() => toggleExtra(op)}
                        style={{
                            padding: "10px 15px",
                            borderRadius: 5,
                            backgroundColor: extras.includes(op)
                                ? ACCENT
                                : "transparent",
                            color: extras.includes(op)
                                ? TEXT_WHITE
                                : TEXT_BLACK,
                            cursor: "pointer",
                            fontSize: 14,
                            fontFamily: "Inter",
                            border: `2px solid ${ACCENT}`,
                            textAlign: "center",
                        }}
                    >
                        {op}
                    </div>
                ))}
            </div>

            <hr style={{ borderColor: ACCENT, marginTop: 30 }} />
            <div style={{ ...TITLE_STYLE, marginTop: 10 }}>
                Would you like us to design your interior?
            </div>

            <div style={{ marginTop: 10 }}>
                <span
                    style={{ fontSize: 20, color: ACCENT, cursor: "pointer" }}
                    onClick={() => setShowInfo(!showInfo)}
                >
                    <Plus size={20} />
                </span>
                {showInfo && (
                    <div style={{ marginTop: 10 }}>
                        <div style={SUBTITLE_STYLE}>
                            What do we do at U2 when we design interiors?
                        </div>
                        <div style={PARAGRAPH_STYLE}>
                            At U2, we design spaces that feel like yours. We
                            combine aesthetics, functionality, and emotion to
                            create environments that reflect your lifestyle.
                            Every corner tells your story—with balance, comfort,
                            and purpose.
                        </div>
                    </div>
                )}
            </div>

            <div style={{ display: "flex", gap: 20, marginTop: 10 }}>
                {["yes", "no"].map((op) => (
                    <div
                        key={op}
                        onClick={() => setInteriorDesign(op)}
                        style={{
                            display: "flex",
                            alignItems: "center",
                            cursor: "pointer",
                            gap: 5,
                        }}
                    >
                        <div
                            style={{
                                width: 20,
                                height: 20,
                                borderRadius: "100%",
                                backgroundColor:
                                    interiorDesign === op
                                        ? ACCENT
                                        : "transparent",
                                border: `2px solid ${ACCENT}`,
                            }}
                        />
                        <span style={{ color: TEXT_BLACK }}>
                            {op.toUpperCase()}
                        </span>
                    </div>
                ))}
            </div>

            <hr style={{ borderColor: ACCENT, marginTop: 30 }} />
            <div style={{ ...TITLE_STYLE, marginTop: 10 }}>Total Cost</div>
            <div style={TITLE_STYLE}>
                ${calculateCost()}
                <span style={USD_STYLE}>USD</span>
            </div>

            <button
                onClick={sendWhatsapp}
                style={{
                    marginTop: 20,
                    backgroundColor: ACCENT,
                    color: TEXT_WHITE,
                    fontFamily: "Inter",
                    fontSize: 20,
                    padding: "12px 20px",
                    border: "none",
                    width: "100%",
                    display: "flex",
                    justifyContent: "space-between",
                    alignItems: "center",
                }}
            >
                Send quotation via WhatsApp
                <span style={{ fontSize: 24 }}>→</span>
            </button>
        </div>
    )
}
